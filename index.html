<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ვინინგი - ავეჯი</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head> 
<body>

  <div id="payment-status" class="payment-status" style="display: none;">
    <div class="status-message"></div>
    <button class="status-close" onclick="closePaymentStatus()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Top Banner -->
  <div class="top-banner">
    <div class="container">
      <div class="phone-number">
        <i class="fas fa-phone-alt"></i>
        <span>+995 555139900</span>
      </div>
      <div class="promo-text">
        შპს ჩიკორის ონლაინ განვადების საიტი
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <header class="main-header">
    <div class="container">
      <div class="logo">
        <img src="https://raw.githubusercontent.com/AmirejibiIlia/chikori_web_app/refs/heads/main/logo_transparent.png" alt="Winning Logo" onclick="resetToHome()" style="cursor: pointer;">
      </div>
      <div class="search-bar">
        <input type="text" placeholder="მოძებნეთ პროდუქტი..." />
        <button type="button" onclick="handleSearch()"><i class="fas fa-search"></i></button>
      </div>
      <div class="header-actions">
        <a href="https://www.facebook.com/p/Winning%E1%83%95%E1%83%98%E1%83%9C%E1%83%98%E1%83%9C%E1%83%92%E1%83%98-%E1%83%A7%E1%83%95%E1%83%94%E1%83%9A%E1%83%90%E1%83%A4%E1%83%94%E1%83%A0%E1%83%98-%E1%83%A4%E1%83%90%E1%83%A1%E1%83%93%E1%83%90%E1%83%99%E1%83%9A%E1%83%94%E1%83%91%E1%83%98%E1%83%97-100064303195219/" target="_blank" class="facebook-button">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" class="cart-icon">
          <i class="fas fa-shopping-cart"></i>
        </a>
        <button class="login-btn">
          <i class="fas fa-user"></i>
          <span>შესვლა</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h2>მოითხოვე ფასდაკლება<br>შერჩეულ ავეჯზე</h2>
      <button class="buy-now" onclick="scrollToProducts()">შეიძინე ახლავე</button>
    </div>
    <div class="hero-image">
      <img src="https://wigmoretrading.com/wp-content/uploads/2024/03/iStock-1405630640.jpg" alt="Luxury Modern Furniture" />
    </div>
  </section>

  <!-- Filters -->
  <div class="filters-section">
    <div class="container">
      <div class="filters">
        <div class="filter-group">
          <select class="filter-select">
            <option value="">ფასი</option>
            <option value="0-500">0₾ - 500₾</option>
            <option value="500-1000">500₾ - 1000₾</option>
            <option value="1000+">1000₾ +</option>
          </select>
        </div>
        <div class="sort-group">
          <select class="sort-select">
            <option value="">დალაგება</option>
            <option value="price-low">ფასი: დაბლიდან მაღლა</option>
            <option value="price-high">ფასი: მაღლიდან დაბლა</option>
            <option value="newest">უახლესი</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Grid -->
  <main class="products-section" id="products">
    <div class="container">
      <h2 class="section-title">ავეჯი თქვენთვის</h2>
      <div class="product-grid">
        <!-- Product cards will be rendered by JavaScript -->
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      
    </div>
  </footer>

  <!-- Detailed Footer Section (from image) -->
  <div class="detailed-footer">
    <div class="container detailed-footer-grid">
      <div class="footer-col">
        <ul>
          <li><a class="footer-link-btn" href="info.html">წესები და პირობები</a></li>
          <li><a class="footer-link-btn" href="info.html">კომპანიის შესახებ</a></li>
          <li><a class="footer-link-btn" href="info.html">კონფიდენციალურობა</a></li>
          <li><a class="footer-link-btn" href="info.html">ანგარიშსწორება</a></li>
          <li><a class="footer-link-btn" href="info.html">მიწოდება და დაბრუნება</a></li>
        </ul>
      </div>
      <div class="footer-col contact-info">
        <div>კითხვების შემთხვევაში დაგვიკავშირდით</div>
        <div class="footer-contact-row">
          <span><span class="footer-icon phone"></span> 555139900</span>
        </div>
        <div class="footer-contact-row">
          <span><span class="footer-icon email"></span> Ilia.amirejibi.07@gmail.com</span>
        </div>
        <div class="footer-address">მისამართი: წყაროს ქუჩა N12</div>
      </div>
      <div class="footer-col payment-methods">
        <div>გადახდის მეთოდები</div>
        <div class="footer-pay-images">
          <img src="https://be.ge/3224314eb10e-desktop.webp" alt="Payment Method 1" style="height:40px; margin-right:10px;" />
          <img src="https://be.ge/f905ed9607be-desktop.webp" alt="Payment Method 2" style="height:40px;" />
        </div>
      </div>
    </div>
    <div class="container detailed-footer-bottom" style="justify-content: center; text-align: center;">
      <div style="width: 100%;">
        Copyright © 2025 | Ganvadeba.store <br>
        ყველა უფლება დაცულია
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="app.js"></script>
  <script>
    // Add this new function for smooth scrolling
    function scrollToProducts() {
      const productsSection = document.getElementById('products');
      productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // New function to handle search
    function handleSearch() {
      // First perform the search (assuming there's existing search functionality)
      // If you have an existing search function, call it here
      // searchProducts(); // Your existing search function

      // Then scroll to products
      scrollToProducts();
    }

    // Payment status handling
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const statusDiv = document.getElementById('payment-status');
      const statusMessage = statusDiv.querySelector('.status-message');

      if (status) {
        statusDiv.style.display = 'block';
        if (status === 'success') {
          statusMessage.innerHTML = `
            <i class="fas fa-check-circle"></i>
            <span>გილოცავთ! გადახდა წარმატებით დასრულდა!</span>
          `;
          statusDiv.className = 'payment-status success';
        } else if (status === 'failure') {
          statusMessage.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <span>ბოდიში, გადახდა ვერ შესრულდა. გთხოვთ დაუკავშირდეთ: <strong>555139900</strong></span>
          `;
          statusDiv.className = 'payment-status error';
        }
        
        // Auto-hide after 8 seconds for better user experience
        setTimeout(() => {
          closePaymentStatus();
        }, 8000);
      }
    };

    // Function to close payment status
    function closePaymentStatus() {
      const statusDiv = document.getElementById('payment-status');
      statusDiv.style.display = 'none';
      // Clean up URL parameters
      window.history.replaceState({}, document.title, window.location.pathname);
    }

    // Dropdown functionality
    function toggleDropdown(id) {
      const dropdown = document.getElementById(`dropdown-${id}`);
      const isVisible = dropdown.style.display === "block";
      
      // Close all dropdowns first
      const allDropdowns = document.querySelectorAll('.dropdown');
      allDropdowns.forEach(dd => {
        dd.style.display = "none";
        // Also hide all sub-options
        dd.querySelectorAll('.sub-options').forEach(sub => sub.style.display = "none");
        // Remove active class from all buttons
        dd.querySelectorAll('.main-option-btn').forEach(btn => btn.classList.remove('active'));
      });
      
      // Toggle current dropdown
      dropdown.style.display = isVisible ? "none" : "block";
      
      // Prevent event bubbling
      event.stopPropagation();
    }

    function showSubOptions(productId, optionType) {
      // Hide all sub-options for this product
      const allSubOptions = document.querySelectorAll(`#${productId}-later, #${productId}-installment, #${productId}-card`);
      allSubOptions.forEach(sub => sub.style.display = "none");
      
      // Remove active class from all buttons in this product's dropdown
      const dropdown = document.getElementById(`dropdown-${productId}`);
      const allButtons = dropdown.querySelectorAll('.main-option-btn');
      allButtons.forEach(btn => btn.classList.remove('active'));
      
      // Add active class to the clicked button
      const clickedButton = event.target;
      clickedButton.classList.add('active');
      
      // Show the selected sub-option
      const targetSubOption = document.getElementById(`${productId}-${optionType}`);
      targetSubOption.style.display = "block";
      
      // Prevent event bubbling
      event.stopPropagation();
    }

    // Add home reset functionality
    function resetToHome() {
      // Reset search input
      const searchInput = document.querySelector('.search-bar input');
      searchInput.value = '';
      
      // Reset filter dropdowns to default
      document.querySelectorAll('.filter-select, .sort-select').forEach(select => {
        select.selectedIndex = 0;
        const event = new Event('change', { bubbles: true });
        select.dispatchEvent(event);
      });

      // Reset all products visibility and ensure correct payment options
      const paymentOptions = {
        'later': {
          'ნაწილ-ნაწილ': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/bog.png" class="bank-icon" alt="BOG">',
          'განაწილება': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/tbc.png" class="bank-icon" alt="TBC">'
        },
        'installment': {
          'საქართველოს ბანკი': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/bog.png" class="bank-icon" alt="BOG">',
          'თიბისი': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/tbc.png" class="bank-icon" alt="TBC">'
        },
        'card': {
          'TBC card': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/tbc.png" class="bank-icon" alt="TBC">',
          'BoG card': '<img src="https://extra.ge/assets/atomic-assets/img/svg-icons/bog.png" class="bank-icon" alt="BOG">'
        }
      };

      document.querySelectorAll('.product-card').forEach(card => {
        // Reset visibility
        card.classList.remove('filtered', 'hidden');
        card.style.removeProperty('display');
        card.style.opacity = '1';
        card.style.visibility = 'visible';

        const productId = card.id;
        
        // Remove active class from all buttons
        const allButtons = card.querySelectorAll('.main-option-btn');
        allButtons.forEach(btn => btn.classList.remove('active'));
        
        // Update later payment options
        const laterOptions = card.querySelectorAll(`#${productId}-later .sub-option`);
        laterOptions.forEach(option => {
          const text = option.textContent.trim();
          if (text.includes('ნაწილ-ნაწილ')) {
            option.innerHTML = `ნაწილ-ნაწილ ${paymentOptions.later['ნაწილ-ნაწილ']}`;
          } else if (text.includes('განაწილება')) {
            option.innerHTML = `განაწილება ${paymentOptions.later['განაწილება']}`;
          }
        });

        // Update installment options
        const installmentOptions = card.querySelectorAll(`#${productId}-installment .sub-option`);
        installmentOptions.forEach(option => {
          const text = option.textContent.trim();
          if (text.includes('საქართველოს ბანკი')) {
            option.innerHTML = `საქართველოს ბანკი ${paymentOptions.installment['საქართველოს ბანკი']}`;
          } else if (text.includes('თიბისი')) {
            option.innerHTML = `თიბისი ${paymentOptions.installment['თიბისი']}`;
          }
        });

        // Update card options
        const cardOptions = card.querySelectorAll(`#${productId}-card .sub-option`);
        cardOptions.forEach(option => {
          const text = option.textContent.trim();
          if (text.includes('TBC card')) {
            option.innerHTML = `TBC card ${paymentOptions.card['TBC card']}`;
          } else if (text.includes('BoG card')) {
            option.innerHTML = `BoG card ${paymentOptions.card['BoG card']}`;
          }
        });
      });

      // Reset any active filter indicators
      document.querySelectorAll('.active-filter').forEach(filter => {
        filter.classList.remove('active-filter');
      });

      // Reset any global filter state variables
      if (window.currentFilter) window.currentFilter = null;
      if (window.currentSort) window.currentSort = null;

      // Scroll to top smoothly
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });

      // Force a re-render of the products if needed
      if (typeof updateProductDisplay === 'function') {
        updateProductDisplay();
      }
      // Always re-render products
      if (typeof renderProducts === 'function') {
        renderProducts(window.products || []);
      }
    }

    // Check if we're in development mode and show debug section
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      document.getElementById('debug-section').style.display = 'block';
    }
    
    // Load debug information
    async function loadDebugInfo() {
      try {
        const response = await fetch('/api/debug-tbc-payment');
        const data = await response.json();
        
        const debugOutput = document.getElementById('debug-output');
        debugOutput.innerHTML = `
          <h4>Current Configuration:</h4>
          <pre>${JSON.stringify(data.current_configuration, null, 2)}</pre>
          
          <h4>Sample Request:</h4>
          <pre>${JSON.stringify(data.sample_request, null, 2)}</pre>
          
          <h4>Sample Flitt Request:</h4>
          <pre>${JSON.stringify(data.sample_flitt_request, null, 2)}</pre>
        `;
      } catch (error) {
        console.error('Error loading debug info:', error);
        document.getElementById('debug-output').innerHTML = `<p>Error loading debug info: ${error.message}</p>`;
      }
    }
  </script>

</body>
</html>