<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ჩიკორი - პროდუქცია</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head> 
<body>

  <div id="payment-status" class="payment-status" style="display: none;">
    <div class="status-message"></div>
  </div>

  <header>
    <div class="header-content">
      <h1>აირჩიეთ სასურველი პროდუქტი</h1>
      <a href="https://www.facebook.com/p/Winning%E1%83%95%E1%83%98%E1%83%9C%E1%83%98%E1%83%9C%E1%83%92%E1%83%98-%E1%83%A7%E1%83%95%E1%83%94%E1%83%9A%E1%83%90%E1%83%A4%E1%83%94%E1%83%A0%E1%83%98-%E1%83%A4%E1%83%90%E1%83%A1%E1%83%93%E1%83%90%E1%83%99%E1%83%9A%E1%83%94%E1%83%91%E1%83%98%E1%83%97-100064303195219/" target="_blank" class="facebook-button">
        <i class="fab fa-facebook-f"></i>
      </a>
    </div>
  </header>

  <main>
    <div class="product-grid">

      <div class="product-card" onclick="toggleDropdown('table')">
        <img class="product-image" src="https://gorgia.ge/images/ab__webp/thumbnails/1223/1000/detailed/53/BM-00146724_-_Closet_jpg.webp" alt="მაგიდა" />
        <h2>კარადა</h2>
        <p class="price">₾250</p>
        <div class="dropdown" id="table">
          <h3>💳 გადახდის მეთოდები</h3>
          <div class="main-options">
            <button class="main-option-btn" onclick="showSubOptions('table', 'later')">გადახდა განაწილებით</button>
            <button class="main-option-btn" onclick="showSubOptions('table', 'installment')">განვადება</button>
          </div>
          <div class="sub-options" id="table-later" style="display: none;">
            <div class="sub-option" onclick="selectOption('table', 'ნაწილ-ნაწილ')">ნაწილ-ნაწილ 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('table', 250, 'TABLE_001', 'installment_split')">განაწილება 🔵</div>
          </div>
          <div class="sub-options" id="table-installment" style="display: none;">
            <div class="sub-option" onclick="selectOption('table', 'საქართველოს ბანკი')">საქართველოს ბანკი 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('table', 250, 'TABLE_001', 'installment_standard')">თიბისი 🔵</div>
          </div>
        </div>
      </div>

      <div class="product-card" onclick="toggleDropdown('bed')">
        <img class="product-image" src="https://gorgia.ge/images/ab__webp/thumbnails/1223/1000/detailed/64/BM-00201015-_1__jpg.webp" alt="საწოლი" />
        <h2>საწოლი</h2>
        <p class="price">₾650</p>
        <div class="dropdown" id="bed">
          <h3>💳 გადახდის მეთოდები</h3>
          <div class="main-options">
            <button class="main-option-btn" onclick="showSubOptions('bed', 'later')">გადახდა განაწილებით</button>
            <button class="main-option-btn" onclick="showSubOptions('bed', 'installment')">განვადება</button>
          </div>
          <div class="sub-options" id="bed-later" style="display: none;">
            <div class="sub-option" onclick="selectOption('bed', 'ნაწილ-ნაწილ')">ნაწილ-ნაწილ 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('bed', 650, 'BED_001', 'installment_split')">განაწილება 🔵</div>
          </div>
          <div class="sub-options" id="bed-installment" style="display: none;">
            <div class="sub-option" onclick="selectOption('bed', 'საქართველოს ბანკი')">საქართველოს ბანკი 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('bed', 650, 'BED_001', 'installment_standard')">თიბისი 🔵</div>
          </div>
        </div>
      </div>

      <div class="product-card" onclick="toggleDropdown('sofa')">
        <img class="product-image" src="https://gorgia.ge/images/ab__webp/thumbnails/1100/900/detailed/5/ab071780-2-_1__jpg.webp" alt="კუთხის დივანი" />
        <h2>სამზარეულოს კუთხე</h2>
        <p class="price">₾650</p>
        <div class="dropdown" id="sofa">
          <h3>💳 გადახდის მეთოდები</h3>
          <div class="main-options">
            <button class="main-option-btn" onclick="showSubOptions('sofa', 'later')">გადახდა განაწილებით</button>
            <button class="main-option-btn" onclick="showSubOptions('sofa', 'installment')">განვადება</button>
          </div>
          <div class="sub-options" id="sofa-later" style="display: none;">
            <div class="sub-option" onclick="selectOption('sofa', 'ნაწილ-ნაწილ')">ნაწილ-ნაწილ 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('sofa', 650, 'SOFA_001', 'installment_split')">განაწილება 🔵</div>
          </div>
          <div class="sub-options" id="sofa-installment" style="display: none;">
            <div class="sub-option" onclick="selectOption('sofa', 'საქართველოს ბანკი')">საქართველოს ბანკი 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('sofa', 650, 'SOFA_001', 'installment_standard')">თიბისი 🔵</div>
          </div>
        </div>
      </div>

      <div class="product-card" onclick="toggleDropdown('desk')">
        <img class="product-image" src="https://gorgia.ge/images/ab__webp/thumbnails/1223/1000/detailed/65/BM-00141262_jpg.webp" alt="სამუშაო მაგიდა" />
        <h2>სამუშაო მაგიდა</h2>
        <p class="price">₾400</p>
        <div class="dropdown" id="desk">
          <h3>💳 გადახდის მეთოდები</h3>
          <div class="main-options">
            <button class="main-option-btn" onclick="showSubOptions('desk', 'later')">გადახდა განაწილებით</button>
            <button class="main-option-btn" onclick="showSubOptions('desk', 'installment')">განვადება</button>
          </div>
          <div class="sub-options" id="desk-later" style="display: none;">
            <div class="sub-option" onclick="selectOption('desk', 'ნაწილ-ნაწილ')">ნაწილ-ნაწილ 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('desk', 400, 'DESK_001', 'installment_split')">განაწილება 🔵</div>
          </div>
          <div class="sub-options" id="desk-installment" style="display: none;">
            <div class="sub-option" onclick="selectOption('desk', 'საქართველოს ბანკი')">საქართველოს ბანკი 🟠</div>
            <div class="sub-option" onclick="initiateTBCInstallment('desk', 400, 'DESK_001', 'installment_standard')">თიბისი 🔵</div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <footer>
    <p>შპს ჩიკორი. კონტაქტი: 555139900, 2025 წელი</p>
  </footer>

  <script src="tbc_integration.js"></script>
  <script>
    function toggleDropdown(id) {
      const dropdown = document.getElementById(id);
      const isVisible = dropdown.style.display === "block";
      
      // Close all dropdowns first
      const allDropdowns = document.querySelectorAll('.dropdown');
      allDropdowns.forEach(dd => {
        dd.style.display = "none";
        // Also hide all sub-options
        dd.querySelectorAll('.sub-options').forEach(sub => sub.style.display = "none");
      });
      
      // Toggle current dropdown
      dropdown.style.display = isVisible ? "none" : "block";
    }

    function showSubOptions(productId, optionType) {
      // Hide all sub-options for this product
      const allSubOptions = document.querySelectorAll(`#${productId}-later, #${productId}-installment`);
      allSubOptions.forEach(sub => sub.style.display = "none");
      
      // Show the selected sub-option
      const targetSubOption = document.getElementById(`${productId}-${optionType}`);
      targetSubOption.style.display = "block";
      
      // Prevent event bubbling to avoid closing the dropdown
      event.stopPropagation();
    }

    function selectOption(productId, option) {
      console.log(`Selected ${option} for ${productId}`);
      // Here you can add logic to process the selection
      // For example, redirect to payment or store the selection
      alert(`თქვენ აირჩიეთ: ${option}`);
      
      // Prevent event bubbling
      event.stopPropagation();
    }

    function initiateTBCInstallment(productId, price, sku, installmentType) {
      const productData = {
        id: sku,
        price: price,
        name: document.querySelector(`#${productId} h2`).textContent,
        installmentType: installmentType
      };
      tbcInstallment.initiateInstallment(productData);
    }

    // Add payment status handling
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const status = urlParams.get('status');
      const statusDiv = document.getElementById('payment-status');
      const statusMessage = statusDiv.querySelector('.status-message');

      if (status) {
        statusDiv.style.display = 'block';
        if (status === 'success') {
          statusMessage.textContent = 'გადახდა წარმატებით დასრულდა!';
          statusDiv.className = 'payment-status success';
        } else if (status === 'failure') {
          statusMessage.textContent = 'გადახდა ვერ შესრულდა. გთხოვთ სცადოთ თავიდან.';
          statusDiv.className = 'payment-status error';
        }
        
        // Hide the message after 5 seconds
        setTimeout(() => {
          statusDiv.style.display = 'none';
          // Remove status from URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }, 5000);
      }
    };
  </script>

</body>
</html>